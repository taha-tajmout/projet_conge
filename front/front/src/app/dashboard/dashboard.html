<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<div class="dashboard-container">

<!-- ajouter √ßa derni√®rement -->
  <!-- Message de succ√®s -->
  <div *ngIf="showSuccessMessage" class="success-message">
    <span>‚úì Vos informations ont √©t√© mises √† jour avec succ√®s</span>
    <button class="close-message" (click)="showSuccessMessage = false">&times;</button>
  </div>

  
  <div class="header">
    <h2>Tableau de bord</h2>
    <p>Bienvenue, {{userData?.prenom}} {{userData?.nom}} ({{userData?.statut}})</p>
  </div>
    <!-- Modal pour g√©rer le compte -->
  

<div *ngIf="showAccountModal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Gestion de votre compte</h2>
      <button class="close-btn" (click)="fermerModalCompte()">&times;</button>
    </div>
    <div class="modal-body">
      <form (ngSubmit)="mettreAJourCompte()">
        
        <!-- Champs pour utilisateurs normaux -->
        <div *ngIf="!isAdmin()" class="form-group">
          <label for="nom">Nom :</label>
          <input type="text" id="nom" [(ngModel)]="utilisateurModifie.nom" name="nom" required>
        </div>
        
        <div *ngIf="!isAdmin()" class="form-group">
          <label for="prenom">Pr√©nom :</label>
          <input type="text" id="prenom" [(ngModel)]="utilisateurModifie.prenom" name="prenom" required>
        </div>
        
        <!-- Champ email pour tous -->
        <div class="form-group">
          <label for="email">Adresse e-mail :</label>
          <input type="email" id="email" [(ngModel)]="utilisateurModifie.email" name="email" required>
        </div>
        
        <!-- Champ mot de passe pour tous -->
        <div class="form-group password-group">
          <label for="motDePasse">Mot de passe :</label>
          <div class="password-input-container">
            <input [type]="showPassword ? 'text' : 'password'" id="motDePasse" 
                   [(ngModel)]="utilisateurModifie.motDePasse" name="motDePasse" required>
            <button type="button" class="toggle-password" (click)="togglePasswordVisibility()">
              <span *ngIf="!showPassword">üëÅÔ∏è</span>
              <span *ngIf="showPassword">üîí</span>
            </button>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" (click)="fermerModalCompte()">Annuler</button>
          <button type="submit">Enregistrer</button>
        </div>
      </form>
    </div>
  </div>
</div>

  

  <div class="stats-container">
    <div class="stat-card">
      <h3>Cong√©s disponibles</h3>
      <p class="stat-value">{{userData?.soldeConge}}</p>
      <span class="stat-unit">jours</span>
    </div>

    
    <div class="stat-card">
      <h3>Cong√©s approuv√©s</h3>
      <p class="stat-value">{{congesPris}}</p>
      <span class="stat-unit">jours</span> <!-- √Ä remplacer par une valeur dynamique -->
    </div>
    
    <div class="stat-card">
      <h3>En attente</h3>
      <p class="stat-value">{{demandesEnAttenteCount}}</p>
      <span class="stat-unit">demande<span *ngIf="demandesEnAttenteCount > 1">s</span></span> <!-- √Ä remplacer par une valeur dynamique -->
    </div>
  </div>
<!-- Modal de gestion des demandes -->
<div *ngIf="showModal" class="modal-overlay">
  <div class="modal-container">
    <h3>G√©rer la demande</h3>
    
    <div class="modal-actions">
      <button class="btn btn-accept" (click)="acceptDemande()">Accepter</button>
      <button class="btn btn-reject" (click)="toggleRejectReason()">Refuser</button>
    </div>
    
    <div *ngIf="showRejectReason" class="reject-reason">
      <textarea [(ngModel)]="rejectReason" placeholder="Motif du refus..."></textarea>
      <button class="btn btn-confirm" (click)="rejectDemande()">Confirmer le refus</button>
    </div>
    
    <button class="btn btn-close" (click)="closeModal()">Fermer</button>
  </div>
</div>
<div class="button-container">
  <!-- NOUVELLE LOGIQUE : Selon la hi√©rarchie stricte -->
  
  <!-- Cadre et Technicien : peuvent faire demande -->
  <div *ngIf="isCadreOrTechnicien()">
    <button class="btn btn-primary" (click)="creerDemande()">Faire une demande</button>
  </div>
  
  <!-- RH : peut faire demande (va au directeur) ET voir les demandes valid√©es -->
  <div *ngIf="isRH()">
    <button class="btn btn-primary" (click)="creerDemande()">Faire une demande</button>
    <button class="btn btn-info" (click)="voirDemandesValidees()">Voir les demandes valid√©es</button>
  </div>
  
  <!-- Chef de service : peut faire demande ET g√©rer -->
  <div *ngIf="isChefService()">
    <button class="btn btn-primary" (click)="creerDemande()">Faire une demande</button>
    <button class="btn btn-secondary" (click)="gererDemandes()">G√©rer les demandes</button>
  </div>
  
  <!-- Chef de division : peut faire demande ET g√©rer -->
  <div *ngIf="isChefDivision()">
    <button class="btn btn-primary" (click)="creerDemande()">Faire une demande</button>
    <button class="btn btn-secondary" (click)="gererDemandes()">G√©rer les demandes</button>
  </div>
  
  <!-- Directeur : SEULEMENT g√©rer (ne peut pas faire demande) -->
  <div *ngIf="isDirecteur()">
    <button class="btn btn-secondary" (click)="gererDemandes()">G√©rer les demandes</button>
  </div>
</div>
  <div class="historique">
    <h3>Votre historique de demandes :</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Type de cong√©</th>
          <th>Date de d√©but</th>
          <th>Date de fin</th>
          <th>Dur√©e</th>
          <th>Statut</th>
          <th>Date de demande</th>
        </tr>
      </thead>
      <tbody>
        <!-- Nouvelle demande (si elle existe) -->
      <!--
         <tr *ngIf="nouvelleDemande">
          <td>{{ nouvelleDemande.typeDeConge }}</td>
          <td>{{ nouvelleDemande.dateDebut | date:'dd/MM/yyyy' }}</td>
          <td>{{ nouvelleDemande.dateFin | date:'dd/MM/yyyy' }}</td>
          <td>{{ nouvelleDemande.duree }} jour(s)</td>
          <td>
            <span class="pending">{{ nouvelleDemande.statut }}</span>
          </td>
          <td>{{ nouvelleDemande.dateDemande | date:'dd/MM/yyyy' }}</td>
        </tr>-->     
         <!-- Demandes existantes -->
        <tr *ngFor="let conge of conges">
          <td>{{ conge.typeDemande || conge.typeDeConge }}</td>
          <td>{{ conge.dateDebut | date:'dd/MM/yyyy' }}</td>
          <td>{{ conge.dateFin | date:'dd/MM/yyyy' }}</td>
          <td>{{ conge.duree }} jour(s)</td>
          <td>
            <span [ngClass]="{
              'approved': conge.statut === 'Approuv√©',
              'pending': conge.statut === 'En attente',
              'rejected': conge.statut === 'Rejet√©'
            }">
              {{conge.statut}}
            </span>
          </td>
          <td>{{ conge.dateDemande | date:'dd/MM/yyyy' }}</td>
        </tr>
                <!-- Message si aucune demande -->
        <tr *ngIf="conges.length === 0">
          <td colspan="6" style="text-align: center; padding: 20px;">
            Aucune demande trouv√©e
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>